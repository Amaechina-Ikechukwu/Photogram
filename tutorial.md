## Photogram — Developer Tutorial

This document was generated by scanning the project. It summarizes the app structure, setup steps, how to run and develop locally, key implementation details, and troubleshooting tips.

---

## Quick plan / checklist

- [x] Describe project purpose and tech stack
- [x] List prerequisites and developer environment setup
- [x] Show how to provide Firebase credentials used by the app
- [x] Explain how to run the app locally (PowerShell examples)
- [x] Outline core app structure and important files/components
- [x] Explain key behaviors (auth flow, photo upload, refresh)
- [x] Provide troubleshooting and next steps

Notes: while scanning the code I could not read `auth/login.tsx` and `auth/signup.tsx` (file read returned an error). They appear in the workspace listing but were unavailable to the scanner — if you want, I can open or recreate them and add screenshots/examples.

---

## Project summary

Photogram is an Expo React Native app (expo-router) that provides a simple image-sharing flow. It uses Firebase (Auth, Firestore, Storage) for backend services. The UI includes a parallax header, themed components, and an image grid. Photos are uploaded to Firebase Storage under `photos/{uid}/`.

Tech stack (from `package.json`)

- Expo SDK ~53
- React Native 0.79.5
- Expo Router
- Firebase (v12)
- react-native-reanimated, expo-image, expo-image-picker, async-storage

---

## Prerequisites

- Node.js (LTS recommended)
- npm or yarn
- Expo CLI (optional but recommended): `npm install -g expo-cli` or use `npx expo` bundles
- A Firebase project with Authentication, Firestore (optional), and Storage enabled

Optional (for cloud EXIF stripping): Firebase CLI and Cloud Functions runtime (the README mentions a Python function for EXIF removal — this repo doesn't contain functions code, so deploy separately if used).

---

## Environment variables / Firebase config

The app reads Firebase configuration from environment variables in `firebaseConfig.ts`. The expected keys (used as `process.env.EXPO_PUBLIC_...`) are:

- EXPO_PUBLIC_API_KEY
- EXPO_PUBLIC_AUTH_DOMAIN
- EXPO_PUBLIC_PROJECT_ID
- EXPO_PUBLIC_STORAGE_BUCKET
- EXPO_PUBLIC_MESSEGING_SENDER_ID
- EXPO_PUBLIC_APP_ID

These must be set before starting the bundler so that Expo can inline them into the JS bundle.

PowerShell examples (temporary environment for current session):

```powershell
# set environment variables for the current PowerShell session
$env:EXPO_PUBLIC_API_KEY = "your_api_key_here"
$env:EXPO_PUBLIC_AUTH_DOMAIN = "your-project.firebaseapp.com"
$env:EXPO_PUBLIC_PROJECT_ID = "your-project-id"
$env:EXPO_PUBLIC_STORAGE_BUCKET = "your-project.appspot.com"
$env:EXPO_PUBLIC_MESSEGING_SENDER_ID = "1234567890"
$env:EXPO_PUBLIC_APP_ID = "1:...:web:..."

# then start the app
npm install; npm run start
```

If you prefer persistent local env, use a `.env` file and a loader (e.g., `dotenv` or `expo` config plugins). Because the project expects `process.env.EXPO_PUBLIC_*`, ensure those variables are available at bundle-time.

Firebase console quick checklist

- Enable Email/Password sign-in (or other providers you intend to use)
- Create a Storage bucket and set rules to allow authenticated uploads (for dev, you may relax rules but follow best practices in production)
- (Optional) Configure Firestore if you plan to store photo metadata

Storage path used by code: `photos/{auth.currentUser.uid}/{timestamp}.jpg`

---

## Install & run (local development)

1) Install dependencies

```powershell
npm install
```

2) Start Expo bundler

```powershell
npm run start
# or to run on android / ios / web
npm run android
npm run ios
npm run web
```

Notes:
- The project uses `expo-router`. The app entry is `expo-router/entry` per `package.json`.
- Root layout (`app/_layout.tsx`) initializes fonts, sets up Firebase auth listener and redirects to either `/(tabs)` (authenticated) or `/auth/login`.

---

## App structure (important files)

- `app/_layout.tsx` — root layout, theme provider, firebase auth check and routing.
- `app/(tabs)/index.tsx` — main photos screen (grid) using Firebase Storage to list and display images.
- `app/(tabs)/upload.tsx` — image picker + uploader using `expo-image-picker` and `firebase/storage` uploadBytesResumable.
- `app/+not-found.tsx` — fallback screen (expo-router)
- `auth/` — auth screens (login/signup). NOTE: scanner couldn't read `auth/login.tsx` and `auth/signup.tsx` during this pass.
- `components/ParallaxScrollView.tsx` — parallax header and scroll handling.
- `components/ThemedView.tsx`, `components/ThemedText.tsx` — small theme-aware wrappers.
- `firebaseConfig.ts` — initializes Firebase app, `initializeAuth` with React Native persistence (AsyncStorage), exports `auth`, `db`, `storage`.
- `scripts/reset-project.js` — project helper script

---

## How key flows work

Authentication and routing

- `app/_layout.tsx` subscribes to `onAuthStateChanged(auth, ...)`. When a user is present, it calls `router.replace('/(tabs)')`. If not present it sends to `/auth/login`.

Photos listing

- `app/(tabs)/index.tsx` uses `firebase/storage` `listAll()` on `photos/{uid}` to get items, then `getDownloadURL` on each item and renders them in a 2-column `FlatList`.
- The header image is the first URL (if any) and is shown inside the `ParallaxScrollView`.

Upload flow

- `app/(tabs)/upload.tsx` opens the image library via `expo-image-picker` and returns `result.assets[0].uri`.
- When uploading, code fetches the image URI to a blob, then uploads with `uploadBytesResumable` to `photos/{uid}/{timestamp}.jpg` and listens for progress.
- On successful upload, the screen navigates back to `/(tabs)?refresh=${Date.now()}` — the `index.tsx` watches `useLocalSearchParams()` and triggers `onRefresh()` when `refresh` changes.

EXIF stripping

- The repo README references a Python Cloud Function (Pillow) to strip EXIF from images. This repository does not contain that Cloud Function. If privacy-focused EXIF stripping is required, implement and deploy a function that triggers on Storage upload, removes EXIF, and rewrites the object (or writes a sanitized copy).

---

## Troubleshooting & common issues

- Firebase env variables undefined
  - Symptom: initializeApp receives undefined keys or Firebase errors. Ensure the `EXPO_PUBLIC_*` variables are set in your shell before starting Expo.

- Auth redirection loop / stuck states
  - Root layout redirects based on `onAuthStateChanged`. If a persistent redirect occurs, inspect console logs from `onAuthStateChanged` callback and ensure `auth` is initialized only once.

- Upload fails / permission denied
  - Check Storage rules in Firebase Console. For development use rules that allow authenticated users to read/write under `photos/{uid}`.

- Image picker permissions
  - On native devices, ensure the app requests and is granted media library permissions. Expo ImagePicker usually prompts automatically.

- Missing files detected by scanner
  - I couldn't read `auth/login.tsx` and `auth/signup.tsx` during the scan. If those files are missing or moved, routing to `/auth/login` will fail. Verify the `auth/` folder contains `login.tsx` and `signup.tsx`.

---

## Developer notes & suggestions

- Move Firebase env keys into a secure secret manager for production (do not check secrets into Git). Keep only `EXPO_PUBLIC_` keys that are safe to expose in the client.
- Add CI linting step (package.json already has `lint` via `expo lint`). Add a `precommit` hook if desired.
- Add cloud function code for EXIF stripping to the repo (in a `functions/` folder) or document its deployment steps in this repo.
- Add tests for the upload flow: mock Firebase Storage and assert proper calls, progress handling and navigation.

Small UX improvements you might consider

- Show an upload history / metadata panel (size, resolution). Right now photos are listed from Storage only.
- Add pagination for `listAll()` (if many photos) — `listAll()` can be expensive; consider `list()` with pagination.
- Add optimistic UI for uploads and retry support.

---

## Where to go next (actionable items)

1. Verify or add `auth/login.tsx` and `auth/signup.tsx` to the `auth/` folder (scanner reported read errors for those files).
2. Place your Firebase config values in environment variables and test the app start flow.
3. If you require EXIF stripping, either add the Cloud Function to the repo or provide the deployed function's behavior and update storage workflow to use sanitized files.

If you'd like, I can:

- open and inspect the `auth/` files that failed to read, or recreate them from the router expectations;
- add a sample `.env.example` with the required `EXPO_PUBLIC_*` variables and a PowerShell-ready `.env.ps1` helper;
- scaffold a Cloud Function example to remove EXIF and re-upload sanitized images.

---

## Quick reference — commands (PowerShell)

```powershell
# Install
npm install

# Start the dev server
npm run start

# Start on a device/emulator
npm run android
npm run ios
npm run web

# Lint
npm run lint

# Reset project helper (provided)
node ./scripts/reset-project.js
```

---

If you'd like me to commit this file (or make edits, add `.env.example`, or inspect the missing auth pages), tell me which of those you'd like next and I'll proceed.
